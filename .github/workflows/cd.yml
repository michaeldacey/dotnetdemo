on:
    workflow_run:
      workflows: [dotnet build and deploy to Azure Web App]
      types: [completed]
      branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: none
    steps:
      - name: Get the latest Run ID for ci.yml build workflow
        run: echo "RUN_ID=gh run --repo michaeldacey/dotnetdemo list --workflow ci.yml --json databaseId --jq .[0].databaseId" >> $GITHUB_ENV
      - name: Run ID is
        run: echo "Run ID is ${{RUN_ID}}"
      - name: Dowload the artifact from the build workflow
        uses: actions/download-artifact@v4
        with:
          name: myappartifact
          # token with actions:read permissions on target repo
          github-token: ${{ secrets.GH_PAT }} 
          repository: michaeldacey/dotnetdemo
          run-id: ${{env.RUN_ID}}
  